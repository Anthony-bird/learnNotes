本章我看书确实是不是很好理解，有很多东西基本上都没有听说了解过，看着内容苦涩难懂。

### 数据复制

三种流行的复制数据变化的方法：主从复制、 多主节点复制和无主节点复制。

#### 主节点与从节点

主从复制的工作原理：

1. 指定某一个副本为主副本（或称为主节点）。当客户写数据库时， 必须将写请求首先发送给主副本， 主副本首先将新数据写入本地存储。 
2. 其他副本则全部称为从副本（或称为从节点）。 主副本把新数据写入本地存储后， 然后将数据更改作为复制的日志或更改流发送给所有从副本。 每个从副本获得更改日志之后将其应用到本地， 且严格保持与主副本相同的写入顺序。 
3. 客户端从数据库中读数据时，可以在主副本或者从副本上执行查询。 再次强调， 只有主副本才可以接受写请求；从客户端的角度来看， 从副本都是只读的。

主从复制：所有的客户端写入操作都发送到某一个节点（主节点）， 由该节点负责将数据更 改事件发送到其他副本（从节点）。 每个副本都可以接收读请求，但内容可能是 过期值。

#### 同步复制与异步复制

主从复制还经常会被配置为全异步模式。 此时如果主节点发生失败且不可恢复， 则所 有尚未复制到从节点的写请求都会丢失。 这意味着即使向客户端确认了写操作， 却无 法保证数据的持久化。 但全异步配置的优点则是，不管从节点上数据多么滞后， 主节 点总是可以继续响应写请求， 系统的吞吐性能更好。

主节点发生故障时异步复制系统可能会丢失数据。

多主节点复制：系统存在多个主节点， 每个都可以接收写请求，客户端将写请求发送到其中的一个 主节点上，由该主节点负责将数据更改事件同步到其他主节点和自己的从节点。

无主节点复制：客户端将写请求发送到多个节点上，读取时从多个节点上并行读取， 以此检测和纠正某些过期数据。

### 复制滞后问题

试图同步复制所有的从副本， 则单个节点故障或网络中断将使整个系统无法写入。 而且节点越多， 发生故障的概率越高， 所以完全同步的配置现实中反而非常不可靠。

### 节点失效时写入数据库

**读修复与反嫡**

读修复：当客户端并行读取多个副本时， 可以检测到过期的返回值。

反倘过程：一些数据存储有后台进程不断查找副本之间数据的差异， 将任何缺少的数 据从一个副本复制到另一个副本。 与基千主节点复制的复制日志不同， 此反墒过 程并不保证以特定的顺序复制写入， 并且会引入明显的同步滞后。

服务器判断操作是否并发的依据主要依靠对比版本号， 算法的工作流程：

• 服务器为每个主键维护一个版本号， 每当主键新值写入时递增版本号， 并将新版本号与写入的值一起保存。

• 当客户端读取主键时， 服务器将返回所有（未被覆盖的）当前值以及最新的版本号。 且要求写之前， 客户必须先发送读请求。 

• 客户端写主键，写请求必须包含之前读到的版本号、 读到的值和新值合并后的集合。 写请求的响应可以像读操作一样， 会返回所有当前值， 这样就可以像购物车例子那样一步步链接起多个写入的值。 

• 当服务器收到带有特定版本号的写入时，覆盖该版本号或更低版本的所有值（因为知道这些值已经被合并到新传入的值集合中）， 但必须保存更高版本号的所有值（因为这些值与当前的写操作属于并发）。

复制的目的：

1高可用性：即使某台机器出现故障，系统也能保持正常运行。2 连接断开与容错： 允许应用程序在出现网络中断时继续工作。3 低延迟：将数据放置在距离用户较近的地方， 从而实现更快地交互。4可扩展性： 采用多副本读取， 大幅提高系统读操作的吞吐量。