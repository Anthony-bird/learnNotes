## 第9章 一致性与共识

介绍分布式系统下内部组件发生了故障，整个系统依然可以对外提供服务， 构建容错式分布式系统的相关算法和协议。

### 一致性保证

这里指的是强一致性，事务隔离主要是为了处理并发执行事务时的各种临界条件， 而分布式一致性则主要是针对延迟和故障等问题来协调副本之间的状态。

### 可线性化

可线性化是一但新值被写入或读取， 所有后续的读都看到的是最新的值， 直到被再次覆盖。意识是系统对外的效果像单一副本的系统一样。当写操作执行后的读都必须返回最新的值。

### 线性化的依赖条件

加锁与主节点选举，约束与唯一性保证，跨通道的时间依赖。

### 实现线性化系统

主从复制（部分支持可线性化），共识算法（可线性化），无主复制（可能不可线性化）

### 线性化的代价

可线性化与网络延迟：许多分布式数据库选择不支持线性化是为了提高性能，而不是为了保住容错特性。 无论是否发生了网络故障，线性化对性能的影响都是巨大的。

### 分布式事务与共识

主节点选举，原子事务提交

### 原子提交与两阶段提交

从单节点到分布式的原子提交，两阶段提交

### 支持容错的共识

一个或多个节点可以提议某些值， 由共识算法来决定最终值。

共识算法特点：协商一致性(Uniform agreement) 所有的节点都接受相同的决议。诚实性(Integrity) 所有节点不能反悔， 即对一项提议不能有两次决定。合法性 (Validity) 如果决定了值v, 则v一定是由某个节点所提议的。 可终止性(Termination) 节点如果不崩溃则最终一定可以达成决议。